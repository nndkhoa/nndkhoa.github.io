import{g as V}from"./react-vendor-DlBnNAMw.js";import{r as I}from"./utils-B7X1E_CZ.js";var N=I();const $=V(N),x=s=>{const n="/apps/budget-split",t=s.startsWith("/")?s.slice(1):s;return`${n.endsWith("/")?n:`${n}/`}${t}`},F=s=>new Promise(n=>{$.parse(s,{header:!0,skipEmptyLines:!0,encoding:"UTF-8",transformHeader:t=>t.trim().toLowerCase(),complete:t=>{const i=[],e=[],a=[],f=new Set,g=t.meta.fields||[],c=g.includes("name"),w=g.includes("id"),o=g.includes("categories");if(!c||!w||!o){e.push('File CSV thiếu các cột bắt buộc. Yêu cầu: "name", "id", "categories"'),n({employees:[],errors:e,warnings:a});return}t.data.forEach((u,v)=>{const d=v+2;if(!u.name||!u.id||!u.categories){a.push(`Dòng ${d}: Thiếu thông tin bắt buộc`);return}const r=u.id.trim(),l=u.name.trim(),m=u.categories.trim();if(f.has(r)){a.push(`Dòng ${d}: ID "${r}" bị trùng lặp`);return}f.add(r);const b=m.split(",").map(y=>y.trim()).filter(y=>y.length>0);if(b.length===0){a.push(`Dòng ${d}: Không có đề mục hợp lệ`);return}let k;const p=u.moneycap;if(p){const y=p.trim();if(y){const C=parseFloat(y.replace(/[,\s]/g,""));isNaN(C)||C<0?a.push(`Dòng ${d}: Hạn mức "${y}" không hợp lệ (phải là số dương)`):k=C}}i.push({id:r,name:l,categories:b,moneyCap:k})}),i.length===0&&e.length===0&&e.push("Không có dữ liệu nhân viên hợp lệ trong file"),n({employees:i,errors:e,warnings:a})},error:t=>{n({employees:[],errors:[`Lỗi khi đọc file: ${t.message}`],warnings:[]})}})}),O=async()=>{try{const s=x("data/sample.employees.csv"),n=await fetch(s);if(!n.ok)throw new Error("Không thể tải file mẫu. Vui lòng thử lại sau.");const t=await n.text();if(t.trim().startsWith("<!DOCTYPE")||t.trim().startsWith("<!doctype"))throw new Error(`File không tìm thấy tại: ${s}. Vui lòng kiểm tra đường dẫn.`);const i=new Blob([t],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a"),a=URL.createObjectURL(i);e.setAttribute("href",a),e.setAttribute("download","employee_template.csv"),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(a)}catch(s){throw console.error("Error downloading template:",s),new Error("Không thể tải file mẫu. Vui lòng thử lại sau.")}},_=async()=>{try{const s=x("data/sample.employees.csv"),n=await fetch(s);if(!n.ok)return{employees:[],errors:["Không thể tải dữ liệu mẫu. Vui lòng sử dụng tải lên file thay thế."],warnings:[]};const t=await n.text();if(t.trim().startsWith("<!DOCTYPE")||t.trim().startsWith("<!doctype"))return{employees:[],errors:[`Không thể tải dữ liệu mẫu. File không tìm thấy tại: ${s}`],warnings:[]};const i=new Blob([t],{type:"text/csv;charset=utf-8;"}),e=new File([i],"sample.employees.csv",{type:"text/csv"});return await F(e)}catch{return{employees:[],errors:["Không thể tải dữ liệu mẫu. Vui lòng sử dụng tải lên file thay thế."],warnings:[]}}},K=s=>new Promise(n=>{$.parse(s,{header:!0,skipEmptyLines:!0,encoding:"UTF-8",transformHeader:t=>t.trim().toLowerCase(),complete:t=>{const i=[],e=[],a=[],f=new Set,g=new Map,c=t.meta.fields||[],w=c.includes("name"),o=c.includes("price"),u=c.includes("category");if(!w||!o||!u){e.push('File CSV thiếu các cột bắt buộc. Yêu cầu: "name", "price", "category"'),n({tasks:[],errors:e,warnings:a,categories:[]});return}const v=c.find(r=>r==="unbreakable"||r.toLowerCase().includes("không chia nhỏ")||r.toLowerCase().includes("khong chia nho"));t.data.forEach((r,l)=>{const m=l+2;if(!r.name||!r.price||!r.category){a.push(`Dòng ${m}: Thiếu thông tin bắt buộc`);return}const b=r.name.trim(),k=r.price.trim(),p=r.category.trim(),y=r.quantity?r.quantity.trim():"1",C=r.id?.trim()||`TASK_${l+1}`;if(f.has(C)){a.push(`Dòng ${m}: ID "${C}" bị trùng lặp`);return}const T=parseFloat(k.replace(/[,\s]/g,""));if(isNaN(T)||T<=0){a.push(`Dòng ${m}: Giá "${k}" không hợp lệ`);return}if(!p){a.push(`Dòng ${m}: Đề mục không được để trống`);return}let E=1;if(y){const h=parseInt(y.replace(/[,\s]/g,""),10);isNaN(h)||h<1?a.push(`Dòng ${m}: Số lượng "${y}" không hợp lệ (phải là số nguyên dương)`):E=h}let S=!1;const D=v&&r[v]||r.unbreakable;if(D){const h=D.trim().toLowerCase();h==="true"||h==="yes"||h==="1"||h==="có"||h==="co"?S=!0:h==="false"||h==="no"||h==="0"||h==="không"||h==="khong"?S=!1:h!==""&&a.push(`Dòng ${m}: Giá trị "Không chia nhỏ" "${D}" không hợp lệ. Sử dụng true/false, yes/no, 1/0, hoặc có/không`)}f.add(C),i.push({id:C,name:b,price:T,category:p,quantity:E,unbreakable:S});const L=g.get(p)||{taskCount:0,totalValue:0},U=S?1:E;L.taskCount+=U,L.totalValue+=T*E,g.set(p,L)}),i.length===0&&e.length===0&&e.push("Không có dữ liệu công việc hợp lệ trong file");const d=Array.from(g.entries()).map(([r,l])=>({name:r,taskCount:l.taskCount,totalValue:l.totalValue}));n({tasks:i,errors:e,warnings:a,categories:d})},error:t=>{n({tasks:[],errors:[`Lỗi khi đọc file: ${t.message}`],warnings:[],categories:[]})}})}),P=async()=>{try{const s=x("data/sample.tasks.csv"),n=await fetch(s);if(!n.ok)throw new Error("Không thể tải file mẫu. Vui lòng thử lại sau.");const t=await n.text();if(t.trim().startsWith("<!DOCTYPE")||t.trim().startsWith("<!doctype"))throw new Error(`File không tìm thấy tại: ${s}. Vui lòng kiểm tra đường dẫn.`);const i=new Blob([t],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a"),a=URL.createObjectURL(i);e.setAttribute("href",a),e.setAttribute("download","task_template.csv"),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(a)}catch(s){throw console.error("Error downloading template:",s),new Error("Không thể tải file mẫu. Vui lòng thử lại sau.")}},j=async()=>{try{const s=x("data/sample.tasks.csv"),n=await fetch(s);if(!n.ok)return{tasks:[],errors:["Không thể tải dữ liệu mẫu. Vui lòng sử dụng tải lên file thay thế."],warnings:[],categories:[]};const t=await n.text();if(t.trim().startsWith("<!DOCTYPE")||t.trim().startsWith("<!doctype"))return{tasks:[],errors:[`Không thể tải dữ liệu mẫu. File không tìm thấy tại: ${s}`],warnings:[],categories:[]};const i=new Blob([t],{type:"text/csv;charset=utf-8;"}),e=new File([i],"sample.tasks.csv",{type:"text/csv"});return await K(e)}catch{return{tasks:[],errors:["Không thể tải dữ liệu mẫu. Vui lòng sử dụng tải lên file thay thế."],warnings:[],categories:[]}}},W=(s,n,t,i,e="csv")=>{const a=[];s.forEach(l=>{const m=n.find(k=>k.id===l.employeeId),b=t.find(k=>k.id===l.taskId);m&&b&&a.push({"Employee ID":m.id,"Employee Name":m.name,"Employee Categories":m.categories.join(", "),"Task Name":b.name,"Task Price":b.price,"Task Category":b.category})});const f=e==="tsv"?"	":",",g=$.unparse(a,{delimiter:f}),c=e==="tsv"?"text/tab-separated-values":"text/csv",w=new Blob([g],{type:`${c};charset=utf-8;`}),o=document.createElement("a"),u=URL.createObjectURL(w),v=new Date().toISOString().split("T")[0],d=e==="tsv"?"tsv":"csv",r=`${i.replace(/\s+/g,"_")}_assignments_${v}.${d}`;o.setAttribute("href",u),o.setAttribute("download",r),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)},B=(s,n,t="csv")=>{const i=s.map(d=>({"Task Name":d.name,Price:d.price,Category:d.category})),e=t==="tsv"?"	":",",a=$.unparse(i,{delimiter:e}),f=t==="tsv"?"text/tab-separated-values":"text/csv",g=new Blob([a],{type:`${f};charset=utf-8;`}),c=document.createElement("a"),w=URL.createObjectURL(g),o=new Date().toISOString().split("T")[0],u=t==="tsv"?"tsv":"csv",v=`${n.replace(/\s+/g,"_")}_unassigned_${o}.${u}`;c.setAttribute("href",w),c.setAttribute("download",v),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)},Y=(s,n,t,i,e="csv")=>{const a=s.map(l=>{const m=n.filter(p=>p.employeeId===l.id).map(p=>p.taskId),b=t.filter(p=>m.includes(p.id)),k=b.reduce((p,y)=>p+y.price,0);return{"Employee ID":l.id,"Employee Name":l.name,Categories:l.categories.join(", "),"Task Count":b.length,"Total Compensation":k}});a.sort((l,m)=>m["Total Compensation"]-l["Total Compensation"]);const f=e==="tsv"?"	":",",g=$.unparse(a,{delimiter:f}),c=e==="tsv"?"text/tab-separated-values":"text/csv",w=new Blob([g],{type:`${c};charset=utf-8;`}),o=document.createElement("a"),u=URL.createObjectURL(w),v=new Date().toISOString().split("T")[0],d=e==="tsv"?"tsv":"csv",r=`${i.replace(/\s+/g,"_")}_summary_${v}.${d}`;o.setAttribute("href",u),o.setAttribute("download",r),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)};export{P as a,j as b,K as c,O as d,W as e,B as f,Y as g,_ as l,F as p};
