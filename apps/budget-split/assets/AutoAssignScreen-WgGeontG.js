import{r as x,j as e}from"./ui-vendor-D2FDxrtI.js";import{B as E}from"./button-C12IU9SF.js";import{S as V,P as W,C as $}from"./ProjectSummary-DkDj194v.js";import{u as P}from"./index-Bwlh9LrA.js";import{a as T}from"./assignmentAlgorithm-D5_EMhQe.js";import{L as z,P as q,j as u}from"./icons-DwHU0r-f.js";import{R as O,B as H,C as I,X as K,Y as M,T as D,a as G,b as X}from"./charts-kvH0Okn1.js";import"./react-vendor-DlBnNAMw.js";import"./utils-B7X1E_CZ.js";const ne=()=>{const{employees:o,tasks:b,getBudget:j,assignmentResult:n,setAssignments:y,setAssignmentResult:f,regenerateBreakdownFromOriginal:N,nextStep:v,prevStep:w,resetHistory:C,getEmployeeCompensation:S}=P(),k=j(),[i,c]=x.useState("fair"),[d,g]=x.useState(!1),[B,A]=x.useState(n!==null),L=async()=>{g(!0),await new Promise(t=>setTimeout(t,500));try{const t=N(),s=T({employees:o,tasks:t,budget:k,strategy:i});f(s),y(s.assignments),C(),A(!0)}catch(t){console.error("Assignment error:",t)}finally{g(!1)}},F=()=>{n&&v()},R=!!n,m=o.map(t=>{if(!n)return{name:t.name,value:0};const r=n.assignments.filter(a=>a.employeeId===t.id).map(a=>b.find(l=>l.id===a.taskId)).filter(Boolean).reduce((a,l)=>a+(l?.price||0)*(l?.quantity||1),0);return{name:t.name,value:r}}),h=n?o.map(t=>{const s=S(t.id),r=t.moneyCap||0,a=r-s;return{...t,compensation:s,capacity:r,remaining:a}}).filter(t=>t.remaining>0).sort((t,s)=>s.remaining-t.remaining):[],p=["#3B82F6","#8B5CF6","#EC4899","#F97316","#10B981","#06B6D4","#F59E0B","#EF4444","#6366F1","#14B8A6"];return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 py-12",children:e.jsxs("div",{className:"w-full max-w-full md:max-w-[85%]",children:[e.jsx(V,{currentStep:3,totalSteps:5,onPrev:w,onNext:F,canGoNext:R,nextLabel:"Tiếp tục"}),e.jsx(W,{}),e.jsxs($,{children:[e.jsx("h2",{className:"text-3xl font-semibold mb-2",children:"Phân công tự động"}),e.jsx("p",{className:"text-base mb-6 text-text-secondary",children:"Chọn chiến lược phân công và chạy thuật toán tự động"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Chiến lược phân công"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>c("fair"),className:`border-2 p-4 cursor-pointer transition-all duration-200 rounded-lg text-left ${i==="fair"?"bg-primary text-white border-primary shadow-colored":"bg-white border-neutral-grey-medium hover:border-primary"}`,children:[e.jsx("span",{className:"font-semibold block",children:"Công bằng (Round-Robin)"}),e.jsx("p",{className:`text-sm mt-2 ${i==="fair"?"text-white/90":"text-text-secondary"}`,children:"Luân phiên phân công công việc cho nhân viên theo thứ tự"})]}),e.jsxs("button",{type:"button",onClick:()=>c("balanced"),className:`border-2 p-4 cursor-pointer transition-all duration-200 rounded-lg text-left ${i==="balanced"?"bg-primary text-white border-primary shadow-colored":"bg-white border-neutral-grey-medium hover:border-primary"}`,children:[e.jsx("span",{className:"font-semibold block",children:"Cân bằng khối lượng"}),e.jsx("p",{className:`text-sm mt-2 ${i==="balanced"?"text-white/90":"text-text-secondary"}`,children:"Ưu tiên nhân viên có tổng giá trị công việc thấp nhất"})]}),e.jsxs("button",{type:"button",onClick:()=>c("greedy"),className:`border-2 p-4 cursor-pointer transition-all duration-200 rounded-lg text-left ${i==="greedy"?"bg-primary text-white border-primary shadow-colored":"bg-white border-neutral-grey-medium hover:border-primary"}`,children:[e.jsx("span",{className:"font-semibold block",children:"Tham lam (Greedy)"}),e.jsx("p",{className:`text-sm mt-2 ${i==="greedy"?"text-white/90":"text-text-secondary"}`,children:"Ưu tiên công việc giá trị cao và tối ưu hóa sử dụng ngân sách"})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs(E,{variant:"primary",onClick:L,disabled:d,className:"w-full flex items-center justify-center gap-2",children:[d?e.jsx(z,{size:20,className:"animate-spin"}):e.jsx(q,{size:20}),d?"Đang chạy...":B?"Chạy lại":"Chạy phân công tự động"]})}),n&&e.jsxs("div",{className:"space-y-6",children:[m.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Khối lượng công việc theo nhân viên"}),e.jsx("div",{className:"border border-neutral-grey-medium p-4 bg-white rounded-lg",style:{height:"300px",minHeight:"300px",minWidth:0},children:e.jsx(O,{width:"100%",height:"100%",minHeight:250,children:e.jsxs(H,{data:m,margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(I,{strokeDasharray:"3 3",stroke:"#E2E8F0",strokeWidth:1}),e.jsx(K,{dataKey:"name",tick:{fill:"#64748B",fontSize:11,fontWeight:500},stroke:"#E2E8F0",strokeWidth:1,angle:-45,textAnchor:"end",height:80}),e.jsx(M,{tick:{fill:"#64748B",fontSize:11,fontWeight:500},stroke:"#E2E8F0",strokeWidth:1,tickFormatter:t=>`${(t/1e6).toFixed(0)}M`}),e.jsx(D,{formatter:t=>`${t.toLocaleString("vi-VN")} ₫`,contentStyle:{border:"1px solid #60A5FA",borderRadius:"8px",backgroundColor:"#fff",padding:"8px 12px",boxShadow:"0 2px 8px rgba(96, 165, 250, 0.15)"},labelStyle:{color:"#1E293B",fontWeight:600,marginBottom:"4px"},cursor:{fill:"#60A5FA",fillOpacity:.1}}),e.jsx(G,{dataKey:"value",radius:[8,8,0,0],activeBar:{fill:"#60A5FA",fillOpacity:.8},children:m.map((t,s)=>e.jsx(X,{fill:p[s%p.length]},`cell-${s}`))})]})})})]}),(n.unassigned.budgetLimit.length>0||n.unassigned.noMatch.length>0)&&e.jsx("div",{children:e.jsxs("div",{className:"bg-error/5 border-2 border-dashed border-error/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(u,{className:"text-red-600",size:24,strokeWidth:2}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Công việc chưa phân công"}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[n.unassigned.budgetLimit.length+n.unassigned.noMatch.length," công việc"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[n.unassigned.budgetLimit.map(t=>{const s=t.quantity||1,r=t.price*s;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-error/30 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-text-primary",children:t.name}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[r.toLocaleString("vi-VN")," ₫",s>1&&e.jsxs("span",{className:"ml-1",children:["(",t.price.toLocaleString("vi-VN")," ₫ × ",s,t.unbreakable?", không chia nhỏ":"",")"]}),s===1&&t.unbreakable&&e.jsx("span",{className:"ml-1",children:"(không chia nhỏ)"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-bold text-error",children:"Vượt ngân sách"})})]},t.id)}),n.unassigned.noMatch.map(t=>{const s=t.quantity||1,r=t.price*s;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-error/30 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-text-primary",children:t.name}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[r.toLocaleString("vi-VN")," ₫ - Đề mục: ",t.category,s>1&&e.jsxs("span",{className:"ml-1",children:["(",t.price.toLocaleString("vi-VN")," ₫ × ",s,t.unbreakable?", không chia nhỏ":"",")"]}),s===1&&t.unbreakable&&e.jsx("span",{className:"ml-1",children:"(không chia nhỏ)"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-bold text-error",children:"Không có nhân viên phù hợp"})})]},t.id)})]})]})}),h.length>0&&e.jsx("div",{children:e.jsxs("div",{className:"bg-error/5 border-2 border-dashed border-error/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(u,{className:"text-red-600",size:24,strokeWidth:2}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Nhân sự còn định mức"}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[h.length," nhân viên"]})]})]}),e.jsx("div",{className:"space-y-2",children:h.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-error/30 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-text-primary",children:t.name}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Đã sử dụng: ",t.compensation.toLocaleString("vi-VN")," ₫ / ",t.capacity.toLocaleString("vi-VN")," ₫"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-bold text-error",children:["Còn lại: ",t.remaining.toLocaleString("vi-VN")," ₫"]})})]},t.id))})]})})]})]})]})})};export{ne as AutoAssignScreen};
