import{r as l,j as e}from"./ui-vendor-D2FDxrtI.js";import{B as c}from"./button-C12IU9SF.js";import{S as F,P as X,C as $}from"./ProjectSummary-DkDj194v.js";import{u as L}from"./index-Bwlh9LrA.js";import{e as q,f as H,g as O}from"./csvParser-DapJ723n.js";import{A as b}from"./alert-dialog-CUz0YfP6.js";import{k as R,q as K,h as M,F as j,r as W}from"./icons-DwHU0r-f.js";import"./react-vendor-DlBnNAMw.js";import"./charts-kvH0Okn1.js";import"./utils-B7X1E_CZ.js";const ne=()=>{const{employees:d,tasks:m,assignments:o,getTotalAssignedValue:y,getUnassignedTasks:f,getEmployeeCompensation:N,prevStep:w,resetProject:v}=L(),[s,p]=l.useState("csv"),[x,n]=l.useState(!1),[S,g]=l.useState(!1),[C,u]=l.useState(!1),k=y(),a=f(),h="Dự án",T=d.map(t=>{const i=o.filter(r=>r.employeeId===t.id).map(r=>r.taskId),A=m.filter(r=>i.includes(r.id)),z=N(t.id),B=A.reduce((r,I)=>r+(I.quantity||1),0);return{...t,taskCount:B,compensation:z}}).sort((t,i)=>i.compensation-t.compensation),P=async()=>{n(!0);try{q(o,d,m,h,s),await new Promise(t=>setTimeout(t,500))}finally{n(!1)}},E=async()=>{if(a.length===0){g(!0);return}n(!0);try{H(a,h,s),await new Promise(t=>setTimeout(t,500))}finally{n(!1)}},V=async()=>{n(!0);try{O(d,o,m,h,s),await new Promise(t=>setTimeout(t,500))}finally{n(!1)}},D=()=>{window.print()},U=()=>{u(!0)};return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 py-12",children:e.jsxs("div",{className:"w-full max-w-full md:max-w-[85%]",children:[e.jsx(F,{currentStep:5,totalSteps:5,onPrev:w,showStartNew:!0,startNewLabel:"New Project",onStartNew:U}),e.jsx(X,{}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(R,{className:"text-green-600",size:36,strokeWidth:2}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-semibold",children:"Hoàn thành!"}),e.jsx("p",{className:"text-base text-text-secondary",children:"Dự án đã được phân công xong"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Tóm tắt phân công"}),e.jsx("div",{className:"overflow-x-auto border border-neutral-grey-medium max-h-96 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0",children:e.jsxs("tr",{className:"bg-primary text-white",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Nhân viên"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Đề mục"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Số công việc"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Thù lao"})]})}),e.jsx("tbody",{children:T.map((t,i)=>e.jsxs("tr",{className:i%2===0?"bg-white":"bg-neutral-grey-light",children:[e.jsx("td",{className:"px-4 py-3 text-sm border-t border-neutral-grey-medium",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm border-t border-neutral-grey-medium",children:t.categories.join(", ")}),e.jsx("td",{className:"px-4 py-3 text-sm border-t border-neutral-grey-medium text-right",children:t.taskCount}),e.jsxs("td",{className:"px-4 py-3 text-sm border-t border-neutral-grey-medium text-right",children:[t.compensation.toLocaleString("vi-VN")," ₫"]})]},t.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-primary text-white",children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 border-t-2 border-primary text-sm font-semibold",children:"Tổng cộng"}),e.jsx("td",{className:"px-4 py-3 border-t-2 border-primary text-sm text-right font-semibold",children:o.length}),e.jsxs("td",{className:"px-4 py-3 border-t-2 border-primary text-sm text-right font-semibold",children:[k.toLocaleString("vi-VN")," ₫"]})]})})]})})]}),a.length>0&&e.jsx("div",{className:"mb-6 bg-warning/10 border border-warning/30 text-warning p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"flex-shrink-0 mt-1",size:20}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold mb-2",children:["Còn ",a.length," công việc chưa được phân công"]}),e.jsx("p",{className:"text-sm",children:"Bạn có thể xuất danh sách công việc chưa phân công ở bên dưới"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Định dạng xuất"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>p("csv"),className:`border-2 p-4 cursor-pointer transition-all duration-200 rounded-lg text-left ${s==="csv"?"bg-primary text-white border-primary shadow-colored":"bg-white border-neutral-grey-medium hover:border-primary"}`,children:[e.jsx("span",{className:"font-semibold block",children:"CSV (Comma-Separated)"}),e.jsx("p",{className:`text-sm mt-2 ${s==="csv"?"text-white/90":"text-text-secondary"}`,children:"Sử dụng dấu phẩy để phân tách các giá trị, tương thích với Excel"})]}),e.jsxs("button",{type:"button",onClick:()=>p("tsv"),className:`border-2 p-4 cursor-pointer transition-all duration-200 rounded-lg text-left ${s==="tsv"?"bg-primary text-white border-primary shadow-colored":"bg-white border-neutral-grey-medium hover:border-primary"}`,children:[e.jsx("span",{className:"font-semibold block",children:"TSV (Tab-Separated)"}),e.jsx("p",{className:`text-sm mt-2 ${s==="tsv"?"text-white/90":"text-text-secondary"}`,children:"Sử dụng tab để phân tách các giá trị, phù hợp cho xử lý dữ liệu"})]})]})]}),e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"Xuất dữ liệu"}),e.jsxs(c,{variant:"primary",onClick:P,disabled:x,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(M,{size:20}),"Xuất danh sách phân công (",s.toUpperCase(),")"]}),e.jsxs(c,{variant:"secondary",onClick:E,disabled:x||a.length===0,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(j,{size:20}),"Xuất công việc chưa phân công (",s.toUpperCase(),")"]}),e.jsxs(c,{variant:"secondary",onClick:V,disabled:x,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(j,{size:20}),"Xuất báo cáo tóm tắt (",s.toUpperCase(),")"]}),e.jsxs(c,{variant:"outline",onClick:D,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(W,{size:20}),"In trang này"]})]})]}),e.jsx(b,{open:S,onOpenChange:g,title:"Thông báo",description:"Không có công việc chưa phân công để xuất.",confirmText:"Đã hiểu"}),e.jsx(b,{open:C,onOpenChange:u,title:"Bắt đầu dự án mới",description:"Bạn có chắc muốn bắt đầu dự án mới? Mọi dữ liệu hiện tại sẽ được đặt lại.",confirmText:"Bắt đầu mới",cancelText:"Hủy",onConfirm:()=>{v()}})]})})};export{ne as ExportScreen};
