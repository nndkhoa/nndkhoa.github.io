import{j as e,c as O,T as U,I as G,V as q,P as H,C as W,d as Z,e as J,f as Q,g as X,S as Y,h as ee,r as m}from"./ui-vendor-D2FDxrtI.js";import{c as v,B as b}from"./button-C12IU9SF.js";import{S as te,P as se,C as ae}from"./ProjectSummary-DkDj194v.js";import{C as re}from"./CategoryChip-BXzsdSKX.js";import{c as le}from"./charts-kvH0Okn1.js";import{a as I,b as ne,c as ie,d as oe,e as ce,f as de,g as me,D as xe,h as he,i as pe,j as V,k as ue}from"./icons-DwHU0r-f.js";import{u as fe}from"./index-Bwlh9LrA.js";import{d as ge,l as je,p as be}from"./csvParser-DapJ723n.js";import"./react-vendor-DlBnNAMw.js";import"./utils-B7X1E_CZ.js";function ve({...s}){return e.jsx(O,{"data-slot":"select",...s})}function ye({...s}){return e.jsx(q,{"data-slot":"select-value",...s})}function Ne({className:s,size:l="default",children:n,...c}){return e.jsxs(U,{"data-slot":"select-trigger","data-size":l,className:v("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...c,children:[n,e.jsx(G,{asChild:!0,children:e.jsx(I,{className:"size-4 opacity-50"})})]})}function we({className:s,children:l,position:n="popper",align:c="center",...p}){return e.jsx(H,{children:e.jsxs(W,{"data-slot":"select-content",className:v("bg-white text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border border-neutral-grey-medium shadow-md",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,align:c,...p,children:[e.jsx(Ce,{}),e.jsx(Z,{className:v("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:l}),e.jsx(De,{})]})})}function Se({className:s,children:l,...n}){return e.jsxs(J,{"data-slot":"select-item",className:v("focus:bg-blue-100 focus:text-blue-700 [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...n,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(Q,{children:e.jsx(ne,{className:"size-4"})})}),e.jsx(X,{children:l})]})}function Ce({className:s,...l}){return e.jsx(Y,{"data-slot":"select-scroll-up-button",className:v("flex cursor-default items-center justify-center py-1",s),...l,children:e.jsx(ie,{className:"size-4"})})}function De({className:s,...l}){return e.jsx(ee,{"data-slot":"select-scroll-down-button",className:v("flex cursor-default items-center justify-center py-1",s),...l,children:e.jsx(I,{className:"size-4"})})}const ke=[10,25,50,100],ze=({currentPage:s,totalPages:l,onPageChange:n,pageSize:c,onPageSizeChange:p,totalRecords:g,className:i})=>{const x=s===1,d=s===l,o=()=>{x||n(1)},y=()=>{x||n(s-1)},f=()=>{d||n(s+1)},w=()=>{d||n(l)},h=(a,u,C)=>{!C&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),u())};if(l<=1&&!p)return null;const S=g&&c,N=(s-1)*(c||10)+1,j=Math.min(s*(c||10),g||0);return e.jsxs("div",{className:le("flex flex-col sm:flex-row items-center justify-between gap-4 mt-4",i),children:[p&&c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"pageSize",className:"text-sm font-medium text-text-primary",children:"Hiển thị:"}),e.jsxs(ve,{value:c.toString(),onValueChange:a=>p(Number(a)),children:[e.jsx(Ne,{id:"pageSize",className:"w-20 h-8 px-3 py-2 text-sm font-medium bg-white border-neutral-grey-medium focus:border-primary",children:e.jsx(ye,{})}),e.jsx(we,{children:ke.map(a=>e.jsx(Se,{value:a.toString(),children:a},a))})]}),e.jsx("span",{className:"text-sm text-text-secondary",children:S&&`(${N}-${j} / ${g})`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:o,onKeyDown:a=>h(a,o,x),disabled:x,"aria-label":"First page",title:"First page",children:e.jsx(oe,{size:16})}),e.jsx(b,{variant:"outline",size:"sm",onClick:y,onKeyDown:a=>h(a,y,x),disabled:x,"aria-label":"Previous page",title:"Previous page",children:e.jsx(ce,{size:16})}),e.jsxs("div",{className:"px-4 py-2 bg-white border border-neutral-grey-medium font-medium text-sm rounded-lg",children:[e.jsx("span",{className:"sr-only",children:"Page "}),s," ",e.jsx("span",{className:"text-text-secondary",children:"of"})," ",l]}),e.jsx(b,{variant:"outline",size:"sm",onClick:f,onKeyDown:a=>h(a,f,d),disabled:d,"aria-label":"Next page",title:"Next page",children:e.jsx(de,{size:16})}),e.jsx(b,{variant:"outline",size:"sm",onClick:w,onKeyDown:a=>h(a,w,d),disabled:d,"aria-label":"Last page",title:"Last page",children:e.jsx(me,{size:16})})]})]})},Te=25,Me=()=>{const{employees:s,setEmployees:l,nextStep:n,prevStep:c}=fe(),[p,g]=m.useState(null),[i,x]=m.useState(s||[]),[d,o]=m.useState([]),[y,f]=m.useState([]),[w,h]=m.useState(!1),[S,N]=m.useState(!1),[j,a]=m.useState(1),[u,C]=m.useState(Te),D=m.useRef(null),k=async t=>{if(!t.name.match(/\.(csv|tsv)$/i)){o(["Vui lòng chọn file CSV hoặc TSV"]);return}if(t.size>10*1024*1024){o(["File vượt quá kích thước tối đa 10MB"]);return}g(t),h(!0),o([]),f([]),a(1);try{const r=await be(t);x(r.employees),l(r.employees),o(r.errors),f(r.warnings)}catch{o(["Lỗi không xác định khi xử lý file"])}finally{h(!1)}},L=t=>{t.preventDefault(),t.stopPropagation(),N(!0)},E=t=>{t.preventDefault(),t.stopPropagation(),N(!1)},P=t=>{t.preventDefault(),t.stopPropagation()},_=t=>{t.preventDefault(),t.stopPropagation(),N(!1);const r=t.dataTransfer.files[0];r&&k(r)},K=t=>{const r=t.target.files?.[0];r&&k(r)},B=async()=>{h(!0),o([]),f([]),a(1),g(null);try{const t=await je();x(t.employees),l(t.employees),o(t.errors),f(t.warnings)}catch{o(["Lỗi không xác định khi tải dữ liệu mẫu"])}finally{h(!1)}},F=()=>{i.length>0&&d.length===0&&(l(i),n())},R=i.length>0&&d.length===0,M=Math.ceil(i.length/u),$=m.useMemo(()=>{const t=(j-1)*u;return i.slice(t,t+u)},[i,j,u]),z=m.useMemo(()=>i.reduce((t,r)=>t+(r.moneyCap||0),0),[i]);return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 py-12",children:e.jsxs("div",{className:"w-full max-w-full md:max-w-[85%]",children:[e.jsx(te,{currentStep:1,totalSteps:5,onPrev:c,onNext:F,canGoNext:R,nextLabel:"Tiếp tục"}),e.jsx(se,{}),e.jsxs(ae,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-semibold mb-2",children:"Nhập danh sách nhân viên"}),e.jsx("p",{className:"text-base text-text-secondary",children:"Tải lên file CSV/TSV chứa thông tin nhân viên"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"outline",onClick:B,icon:xe,title:"Sử dụng dữ liệu mẫu"}),e.jsx(b,{variant:"outline",onClick:async()=>{try{await ge()}catch{o(["Không thể tải file mẫu. Vui lòng thử lại sau."])}},icon:he,title:"Tải xuống file mẫu"})]})]}),e.jsxs("div",{className:`border-2 border-dashed border-primary/30 p-8 text-center cursor-pointer transition-all duration-200 rounded-xl ${S?"bg-primary/5 border-primary":"bg-white hover:border-primary/50"}`,onDragEnter:L,onDragOver:P,onDragLeave:E,onDrop:_,onClick:()=>D.current?.click(),children:[e.jsx("input",{ref:D,type:"file",accept:".csv,.tsv",onChange:K,className:"hidden","aria-label":"Chọn file CSV hoặc TSV"}),e.jsx(pe,{className:"mx-auto mb-4",size:48,strokeWidth:2}),e.jsx("p",{className:"text-lg font-semibold mb-2",children:p?p.name:"Kéo thả file hoặc nhấp để chọn"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Định dạng: CSV hoặc TSV (tối đa 10MB)"})]}),w&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-base",children:"Đang xử lý file..."})}),d.length>0&&e.jsx("div",{className:"mt-6 bg-error/10 border border-error/30 text-error p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(V,{className:"text-red-600 flex-shrink-0 mt-1",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-red-900 mb-2",children:"Lỗi:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:d.map((t,r)=>e.jsx("li",{className:"text-sm text-red-800",children:t},r))})]})]})}),y.length>0&&e.jsx("div",{className:"mt-6 bg-error/10 border border-error/30 text-error p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(V,{className:"text-yellow-600 flex-shrink-0 mt-1",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-yellow-900 mb-2",children:"Cảnh báo:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:y.map((t,r)=>e.jsx("li",{className:"text-sm text-yellow-800",children:t},r))})]})]})}),i.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ue,{className:"text-green-600",size:24}),e.jsxs("p",{className:"font-semibold text-lg",children:["Tìm thấy ",i.length," nhân viên"]})]}),e.jsx("div",{className:"overflow-x-auto border border-neutral-grey-medium rounded-lg",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary text-white",children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold",children:"STT"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold",children:"ID"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold",children:"Tên"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold",children:"Đề mục"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Hạn mức"})]})}),e.jsx("tbody",{children:$.map((t,r)=>{const A=(j-1)*u+r+1;return e.jsxs("tr",{className:r%2===0?"bg-white":"bg-neutral-grey-light",children:[e.jsx("td",{className:"px-4 py-2 text-sm border-t border-neutral-grey-medium",children:A}),e.jsx("td",{className:"px-4 py-2 text-sm border-t border-neutral-grey-medium",children:t.id}),e.jsx("td",{className:"px-4 py-2 text-sm border-t border-neutral-grey-medium",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-sm border-t border-neutral-grey-medium",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:t.categories.map(T=>e.jsx(re,{category:T,size:"sm"},T))})}),e.jsx("td",{className:"px-4 py-2 text-sm border-t border-neutral-grey-medium text-right",children:t.moneyCap?`${t.moneyCap.toLocaleString("vi-VN")} ₫`:e.jsx("span",{className:"text-text-muted italic",children:"Không giới hạn"})})]},t.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-primary text-white border-t-2 border-primary",children:[e.jsx("td",{colSpan:4,className:"px-4 py-3 text-sm font-semibold text-left",children:"Tổng hạn mức"}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-white text-right",children:z>0?`${z.toLocaleString("vi-VN")} ₫`:e.jsx("span",{className:"text-text-muted italic",children:"Không có hạn mức"})})]})})]})}),e.jsx(ze,{currentPage:j,totalPages:M,onPageChange:a,pageSize:u,onPageSizeChange:t=>{C(t),a(1)},totalRecords:i.length})]})]})]})})};export{Me as EmployeeImportScreen};
